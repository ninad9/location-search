<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
</head>
<body>
<div style="text-align: center;">
    <h2>Login</h2>

    <form id="loginForm" onsubmit="submitLogin(event)">
        <label for="userId">User ID:</label>
        <input type="text" id="userId" name="userId" placeholder="Enter User ID" required /><br><br>

        <label for="password">Password:</label>
        <input type="password" id="password" name="password" placeholder="Enter Password" required /><br><br>

        <button type="submit">Login</button>
    </form>

    <p id="message" style="color:red;"></p>

    <script>
        async function submitLogin(event) {
            event.preventDefault();

            const userId = document.getElementById('userId').value.trim();
            const password = document.getElementById('password').value.trim();
            const message = document.getElementById("message");

            if (!userId) {
                message.innerText = "User ID is required";
                return;
            }
            if (!password) {
                message.innerText = "Password is required";
                return;
            }

            try {
                const response = await fetch('/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId, password })
                });

                if (response.ok) {
                    const text = await response.text();
                    if (text.includes("Login successful")) {
                        window.location.href = "/search";
                    }
                } else if (response.status === 400) {
                    const errors = await response.json();
                    message.innerText = Object.values(errors).join(", ");
                } else {
                    message.innerText = "Unexpected error.";
                }
            } catch (error) {
                console.error(error);
                message.innerText = "Request failed.";
            }
        }
    </script>
</div>
</body>
</html>
